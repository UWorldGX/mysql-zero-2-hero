# 8 单行函数

*****

以下两章讲解MySQL的内置函数。

参阅：<file:\\C:\Users\Nscas\Documents\Navicat\MySQL\Servers\conn1\atguigudb\SQL8-1.sql>

## 8.1 绪论

### 8.1.1 不同DBMS间的函数差异

**DBMS之间差异明显，远大于同一语言不同版本的差异**。仅有很少的函数为所有DBMS共同支持。大部分DBMS会有自己独特的函数，这意味着**采用SQL函数的代码的可移植性极差**。

### 8.1.2 MySQL的内置函数及分类

MySQL提供的内置函数从实现的功能角度可以分为：
数值函数，字符串函数，日期和时间函数，流程控制函数，加密与解密函数，获取MySQL信息函数，聚合函数（或分组函数）。

这些函数又可以分为:**单行函数**，**聚合函数**。

<img src="https://i.imgtg.com/2023/02/17/dtjmS.png" alt="dtjmS.png" border="0">

**单行函数**：

* 操作数据对象，接收参数返回一个结果
* **只对一行进行变换**
* **每行返回一个结果**
* 可以嵌套
* 参数可以是一列或一个值

## 8.2 数值函数

### 8.2.1 基本数值函数

| 函数名 | 用法 |
| --- | --- |
| `ABS(x)` | 返回x绝对值 |
| `SIGN(x)` | 返回x的符号,1/0/-1 |
| `PI()` | 返回π |
| `CEIL(x), CEILING(x)` | 返回>=某个数的最大整数 |
| `FLOOR(x)` | 返回<=某个数的最大整数 |
| `LEAST(x..)` | 返回其中最小值 |
| `GREATEST(x..)` | 返回其中最大值 |
| `MOD(x, y)` | 求余 |
| `RAND(x)` | 返回0-1随机值，x可选，为种子数 |
| `ROUND(x, y)` | 返回一个数经过四舍五入后最接近x的整数，y可选，为保留小数位（y可以取负数） | 
| `TRUNCATE(x, y)` | 返回x截断为前y位小数的结果（y可以取负数） |
| `SQRT(x)` | 返回x平方根，当x为负数时返回`NULL` |

### 8.2.2 角度/弧度互换函数，指对数函数和三角函数

| 函数名 | 用法 |
| --- | --- |
| `RADIANS(x)` | 角度转弧度 |
| `DEGREES(x)` | 弧度转角度 |
| `SIN(x), COS(x), TAN(x), COT(x)` | 三角函数，参数为弧度值 |
| `ASIN(x), ACOS(x), ATAN(x), ATAN2(x, y)` | 反三角函数，参数为弧度值 |
| `POW(x, y), POWER(x, y)` | x的y次幂 |
| `EXP(x)` | e的x次幂 | 
| `LN(x), LOG(x)` | 自然对数 |
| `LOG10(x)` | 常用对数 |
| `LOG2(x)` | 以2为底的对数 |

> 关于`ATAN2(x, y)`
> 例如有两个点(x1, y1)和(x2, y2), 使用该函数将得到`ATAN2(y2-y1, x2-x1)`, 该函数好处在于在x2=x1时依旧可以计算。该函数适合方便地求两点形成的角度的正切值。

### 8.2.3 进制转换函数

| 函数名 | 用法 |
| --- | --- |
| `HEX(x)` | 16进制 |
| `BIN(x)` | 2进制 |
| `OCT(x)` | 8进制 |
| `CONV(x, f1, f2)` | 使x从f1进制转化为f2进制 |

## 8.3 字符串函数

| 函数名 | 用法 |
| --- | --- |
| `ASCII(s)` | 返回s字符串中首字符的ASCII | 
| `CHAR_LENGTH(s), CHARACTER_LENGTH(s)` | 返回s字符串的**字符**数 |
| `LENGTH(s)` | 返回s字符串的**字节数**(取决于字符集) |
| `CONCAT(s1, s2...)` | 连接多个字符串 |
| `CONCAT_WS(x, s1, s2...)` | 同上，但是字符串之间加上x字符 |
| `INSERT(str, idx, len, replacestr)` | 将字符串str从idx位开始, len长度的子串替换为replacestr |
| `REPLACE(str, a, b)` | 将str字符串中所有的a字符串替换为b字符串(a不存在则替换失败) |
| `UPPER(s), UCASE(s)` | |
| `LOWER(s), LCASE(s)` | |
| `LEFT(s, n), RIGHT(s, n)` | |
| `LPAD(str, len, pad), RPAD(str, len, pad)` | 用字符串pad对str最左边/最右边进行填充，直到str的长度为len |
| `LTRIM(s), RTRIM(s)` | 去掉字符串左/右端的空格 |
| `TRIM(s)` | |
| `TRIM([BOTH] s1 FROM s)` | 去掉字符串s首尾的s1 |
| `TRIM(LEADING/TRAILING s1 FROM s)` | 去掉字符串s首/尾的s1 |
| `REPEAT(str, n)` | 返回str重复n次的结果 |
| `SPACE(n)` | 返回n个空格 |
| `STRCMP(s1, s2)` | 比较s1,s2的ASCII码值大小 |
| `SUBSTR(s, index, len), SUBSTRING(s, index, len), MID(s, index, len)` | 返回从字符串s的index位置后面的len个字符 |
| `LOCATE(substr, str)` | 返回字符串substr在字符串str中首次出现的位置, 未找到则返回0 |
| `ELT(m, s1, s2...)` | 返回指定位置的字符串(m=1则返回s1, ...) |
| `FIELD(s, s1, s2...)` | 返回s在一组字符串中首次出现的位置 |
| `FIND_IN_SET(s1, s2)` | 返回字符串s1在s2中出现的位置，其中s2应该是以逗号分隔的字符串 |
| `REVERSE(s)` | 反转字符串 |
| `NULLIF(val1, val2)` | 比较两个字符串，若相等则返回NULL，否则返回val1 |


> 使用时需要特别注意: 字符串的索引不同于数组，是**从1开始**的。
>
> ```sql
> SELECT INSERT('helloworld', 3, 3, 'aaaaa');
> ```
>
> 运行结果为*heaaaaworld*.


## 8.4 日期和时间函数