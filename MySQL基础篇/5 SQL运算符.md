# 5 SQL运算符

*****

参阅：<file:\\C:\Users\Nscas\Documents\Navicat\MySQL\Servers\conn1\sql2-3-1.sql>

## 5.1 算术运算符

| 运算符 | 别名 |
| --- | --- |
| + | |
| - | |
| * | |
| / | DIV |
| % | MOD |

> 对于+，需要注意：
>
> ```sql
> SELECT 100 + '1' -- 实际结果是101('1'发生了隐式转换)
> -- 这是因为，SQL中的+没有连接字符串的作用
> -- 如果要连接字符串，应该使用CONCAT()
> FROM DUAL;
>
> SELECT 100 + 'a' -- 实际结果是100('a'不能转换为数值，看作0)
> FROM DUAL;
> ```
>

对于SQL中的算术运算符，有以下法则：

* 字符串参与运算时，会尝试把字符串隐式转换为数值。若转换失败，则视为**0**来处理。
* `null`与任何数值型运算都得`null`。
* 两个不同数值型运算，结果的类型优先取size较大的。
 * 特别地，/运算默认结果为浮点型。
* /运算，若分母为0，结果为`null`。

## 5.2 比较运算符

比较运算符所得的结果：为真则为**1**，为假则为**0**，其他情况返回`null`。

| 运算符 | 解释 | 功能 |
| --- | --- | --- |
| = | 等于运算符 | 注意不是== |
| <=> | 安全等于运算符 | 见下 |
| != (<>) | 不等于运算符 | |
| >=，<= | 大于（小于）等于运算符 | |
| <, > | 小于（大于）运算符 | |

> 注意:
> 
> ```sql
> SELECT *
> FROM employees
> WHERE commission_pct = NULL;
> ```
>
> 这样写是错误的。
> 由于null参与运算仅返回null，因此相当于过滤条件为Null，无法筛选出数据。

为了解决这个问题，**引入了`<=>`运算符**。它可以对`null`进行如下判断：

* 若运算符左右均为`null`，则返回1。
* 若有一侧为`null`，返回0。

## 5.3 逻辑运算符

总结如下：

| 运算符 | 别名 | 注释 |
| --- | --- | --- |
| AND | && | 注意&&的优先级大于\|\| |
| OR | \|\| | |
| NOT | ! | |
| XOR | | 逻辑异或 |

> 逻辑异或: 两端相同则为假，两端**不相同**则为真。

## 5.4 其他运算符

此外，还有非符号类型的运算符：

| 运算符 | 解释 | 功能 |
| --- | --- | --- |
| IS NULL/ISNULL | 为空运算符 | ... IS NULL/ISNULL() |
| IS NOT NULL | 不为空运算符 | ... IS NOT NULL |
| LEAST | 最小值运算符(实际上是函数) | LEAST(var1, var2...) |
| GREATEST | 最大值运算符(实际上是函数) | GREATEST(var1, var2...) |
| BETWEEN AND | 两者之间运算符（闭区间） | BETWEEN ... AND ... |
| IN | 属于运算符 | IN(set) |
| NOT IN | 不属于运算符 | NOT IN(set) |
| LIKE | 模糊匹配运算符 | LIKE ... |
| REGEXP/RLIKE | 正则表达式运算符 | REGEXP ... |

其中部分运算符本质上是**函数**，用例如下:

```sql
SELECT LEAST('a', 'b', 'y')
FROM DUAL; -- 函数式运算符的写法
```

## 5.5 运算符的优先级

**数值越大，优先级越高**。

| 优先级 | 类别 | 包含的运算符 |
| --- | --- | --- |
| 1 | 赋值运算符 | `:=, =` |
| 2 | 逻辑或(异或) | `||, OR, XOR` |
| 3 | 逻辑与 | `&&, AND` |
| 4 | 逻辑非 | `NOT` | 
| 5 | 其他运算符 | `WHEN, ELSE, BETWEEN, CASE, THEN` |
| 6 | 比较运算符 | `=, >=, >, <=, <, <=>, <>, !=, IS, LIKE, REGEXP, IN` |
| 7 | 管道运算符(按位或) | `|` |
| 8 | 按位与 | `&` |
| 9 | 左移、右移运算符 | `>>, <<` |
| 10 | 加减运算符 | `-,+` |
| 11 | 乘除运算符 | `*, /, %, DIV, MOD` |
| 12 | 按位异或 | `^` |
| 13 | 负号和按位取反 | `-, ~` |
| 14 | 逻辑非？ | `!` |
| 15 | 括号运算符 | `()` |
